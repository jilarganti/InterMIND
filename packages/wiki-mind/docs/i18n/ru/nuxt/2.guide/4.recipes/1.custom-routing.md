---
title: "Пользовательская маршрутизация"
description: "В Nuxt ваша маршрутизация определяется структурой файлов внутри директории pages. Однако, поскольку под капотом используется vue-router, Nuxt предлагает несколько способов добавления пользовательских маршрутов в ваш проект."
---

## Добавление пользовательских маршрутов

В Nuxt ваша маршрутизация определяется структурой файлов внутри [директории pages](/docs/guide/directory-structure/pages). Однако, поскольку под капотом используется [vue-router](https://router.vuejs.org), Nuxt предлагает несколько способов добавления пользовательских маршрутов в ваш проект.

### Конфигурация роутера

Используя [опции роутера](/docs/guide/recipes/custom-routing#router-options), вы можете дополнительно переопределить или расширить свои маршруты с помощью функции, которая принимает отсканированные маршруты и возвращает настроенные маршруты.

Если она возвращает `null` или `undefined`, Nuxt вернется к маршрутам по умолчанию (полезно для изменения входного массива).

```ts [router.options.ts]
import type { RouterConfig } from '@nuxt/schema'

export default {
  // https://router.vuejs.org/api/interfaces/routeroptions.html#routes
  routes: (_routes) => [
    {
      name: 'home',
      path: '/',
      component: () => import('~/pages/home.vue')
    }
  ],
} satisfies RouterConfig
```

::note
Nuxt не будет дополнять новые маршруты, которые вы возвращаете из функции `routes`, метаданными, определенными в `definePageMeta` предоставляемого вами компонента. Если вы хотите, чтобы это произошло, вам следует использовать хук `pages:extend`, который [вызывается во время сборки](/docs/api/advanced/hooks#nuxt-hooks-build-time).
::

### Хук Pages

Вы можете добавлять, изменять или удалять страницы из отсканированных маршрутов с помощью nuxt хука `pages:extend`.

Например, чтобы предотвратить создание маршрутов для любых `.ts` файлов:

```ts [nuxt.config.ts]
import type { NuxtPage } from '@nuxt/schema'

export default defineNuxtConfig({
  hooks: {
    'pages:extend' (pages) {
      // добавить маршрут
      pages.push({
        name: 'profile',
        path: '/profile',
        file: '~/extra-pages/profile.vue'
      })

      // удалить маршруты
      function removePagesMatching (pattern: RegExp, pages: NuxtPage[] = []) {
        const pagesToRemove: NuxtPage[] = []
        for (const page of pages) {
          if (page.file && pattern.test(page.file)) {
            pagesToRemove.push(page)
          } else {
            removePagesMatching(pattern, page.children)
          }
        }
        for (const page of pagesToRemove) {
          pages.splice(pages.indexOf(page), 1)
        }
      }
      removePagesMatching(/\.ts$/, pages)
    }
  }
})
```

### Модуль Nuxt

Если вы планируете добавить целый набор страниц, связанных с определенной функциональностью, вы можете использовать [модуль Nuxt](/modules).

[Nuxt kit](/docs/guide/going-further/kit) предоставляет несколько способов [добавления маршрутов](/docs/api/kit/pages):
- [`extendPages`](/docs/api/kit/pages#extendpages) (callback: pages => void)
- [`extendRouteRules`](/docs/api/kit/pages#extendrouterules) (route: string, rule: NitroRouteConfig, options: ExtendRouteRulesOptions)

## Опции роутера

Помимо настройки опций для [`vue-router`](https://router.vuejs.org/api/interfaces/routeroptions.html), Nuxt предлагает [дополнительные опции](/docs/api/nuxt-config#router) для настройки роутера.

### Использование `router.options`

Это рекомендуемый способ указания [опций роутера](/docs/api/nuxt-config#router).

```ts [router.options.ts]
import type { RouterConfig } from '@nuxt/schema'

export default {
} satisfies RouterConfig
```

Можно добавить больше файлов опций роутера, добавив файлы в хук `pages:routerOptions`. Более поздние элементы в массиве переопределяют более ранние.

::callout
Добавление файла опций роутера в этом хуке включит маршрутизацию на основе страниц, если не установлен параметр `optional`, в этом случае он будет применяться только когда маршрутизация на основе страниц уже включена.
::

```ts [nuxt.config.ts]
import { createResolver } from '@nuxt/kit'

export default defineNuxtConfig({
  hooks: {
    'pages:routerOptions' ({ files }) {
      const resolver = createResolver(import.meta.url)
      // добавить маршрут
      files.push({
        path: resolver.resolve('./runtime/router-options'),
        optional: true
      })
    }
  }
})
```

### Использование `nuxt.config`

**Примечание:** Настраиваются только JSON-сериализуемые [опции](/docs/api/nuxt-config#router):

- `linkActiveClass`
- `linkExactActiveClass`
- `end`
- `sensitive`
- `strict`
- `hashMode`
- `scrollBehaviorType`

```js [nuxt.config]
export default defineNuxtConfig({
  router: {
    options: {}
  }
})
```

### Режим хеша (SPA)

Вы можете включить историю хешей в режиме SPA, используя [конфигурацию](/docs/api/nuxt-config#router) `hashMode`. В этом режиме роутер использует символ хеша (#) перед фактическим URL, который передается внутренне. При включении **URL никогда не отправляется на сервер** и **SSR не поддерживается**.

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  ssr: false,
  router: {
    options: {
      hashMode: true
    }
  }
})
```

### Поведение прокрутки для хеш-ссылок

Вы можете дополнительно настроить поведение прокрутки для хеш-ссылок. Когда вы устанавливаете [конфигурацию](/docs/api/nuxt-config#router) в значение `smooth` и загружаете страницу с хеш-ссылкой (например, `https://example.com/blog/my-article#comments`), вы увидите, что браузер плавно прокручивает к этому якорю.

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  router: {
    options: {
      scrollBehaviorType: 'smooth'
    }
  }
})
```

#### Пользовательская история (продвинутый уровень)

Вы можете дополнительно переопределить режим истории, используя функцию, которая принимает базовый URL и возвращает режим истории. Если она возвращает `null` или `undefined`, Nuxt вернется к истории по умолчанию.

```ts [router.options.ts]
import type { RouterConfig } from '@nuxt/schema'
import { createMemoryHistory } from 'vue-router'

export default {
  // https://router.vuejs.org/api/interfaces/routeroptions.html
  history: base => import.meta.client ? createMemoryHistory(base) : null /* по умолчанию */
} satisfies RouterConfig
```