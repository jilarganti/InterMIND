---
title: "Руководство для авторов модулей"
description: "Узнайте, как создать модуль Nuxt для интеграции, улучшения или расширения любых приложений Nuxt."
image: '/socials/module-author-guide.jpg'
---

Системы [конфигурации](/docs/api/nuxt-config) и [хуков](/docs/guide/going-further/hooks) Nuxt позволяют настраивать каждый аспект Nuxt и добавлять любые интеграции, которые могут вам понадобиться (плагины Vue, CMS, серверные маршруты, компоненты, логирование и т.д.).

**Модули Nuxt** — это функции, которые последовательно выполняются при запуске Nuxt в режиме разработки с помощью `nuxt dev` или при сборке проекта для продакшена с помощью `nuxt build`.
С помощью модулей вы можете инкапсулировать, правильно тестировать и делиться пользовательскими решениями в виде npm-пакетов без добавления ненужного шаблонного кода в ваш проект или требования изменений в самом Nuxt.

## Быстрый старт

Мы рекомендуем начать работу с Nuxt Modules, используя наш [стартовый шаблон](https://github.com/nuxt/starter/tree/module):

::code-group{sync="pm"}

```bash [npm]
npm create nuxt -- -t module my-module
```

```bash [yarn]
yarn create nuxt -t module my-module
```

```bash [pnpm]
pnpm create nuxt -t module my-module
```

```bash [bun]
bun create nuxt -t module my-module
```
::

Это создаст проект `my-module` со всем необходимым шаблонным кодом для разработки и публикации вашего модуля.

**Следующие шаги:**

1. Откройте `my-module` в вашей любимой IDE
2. Установите зависимости, используя ваш любимый менеджер пакетов
3. Подготовьте локальные файлы для разработки с помощью `npm run dev:prepare`
4. Следуйте этому документу, чтобы узнать больше о Nuxt Modules

### Использование стартера

Узнайте, как выполнять основные задачи со стартером модуля.

::tip{icon="i-lucide-video" to="https://vueschool.io/lessons/navigating-the-official-starter-template?friend=nuxt" target="_blank"}
Посмотрите видео Vue School о стартовом шаблоне модуля Nuxt.
::

#### Как разрабатывать

Хотя исходный код вашего модуля находится в директории `src`, в большинстве случаев для разработки модуля вам нужно приложение Nuxt. Для этого предназначена директория `playground`. Это приложение Nuxt, с которым вы можете экспериментировать и которое уже настроено для работы с вашим модулем.

Вы можете взаимодействовать с playground как с любым приложением Nuxt.

- Запустите его сервер разработки с помощью `npm run dev`, он должен перезагружаться автоматически при внесении изменений в ваш модуль в директории `src`
- Соберите его с помощью `npm run dev:build`

::note
Все остальные команды `nuxt` могут использоваться для директории `playground` (например, `nuxt <COMMAND> playground`). Не стесняйтесь объявлять дополнительные скрипты `dev:*` в вашем `package.json`, ссылающиеся на них для удобства.
::

#### Как тестировать

Стартер модуля поставляется с базовым набором тестов:

- Линтер на основе [ESLint](https://eslint.org), запустите его с помощью `npm run lint`
- Тест-раннер на основе [Vitest](https://vitest.dev), запустите его с помощью `npm run test` или `npm run test:watch`

::tip
Не стесняйтесь дополнить эту стандартную стратегию тестирования, чтобы лучше соответствовать вашим потребностям.
::

#### Как собирать

Nuxt Modules поставляются с собственным сборщиком, предоставляемым [`@nuxt/module-builder`](https://github.com/nuxt/module-builder#readme). Этот сборщик не требует никакой конфигурации с вашей стороны, поддерживает TypeScript и гарантирует, что ваши ресурсы правильно упакованы для распространения в других приложениях Nuxt.

Вы можете собрать свой модуль, выполнив `npm run prepack`.

::tip
Хотя сборка вашего модуля может быть полезна в некоторых случаях, большую часть времени вам не нужно будет собирать его самостоятельно: `playground` заботится об этом во время разработки, а скрипт релиза также покрывает это при публикации.
::

#### Как публиковать

::important
Перед публикацией вашего модуля в npm убедитесь, что у вас есть аккаунт на [npmjs.com](https://www.npmjs.com) и что вы аутентифицированы в нем локально с помощью `npm login`.
::

Хотя вы можете опубликовать свой модуль, увеличив его версию и используя команду `npm publish`, стартер модуля поставляется со скриптом релиза, который помогает убедиться, что вы публикуете рабочую версию вашего модуля в npm и многое другое.

Чтобы использовать скрипт релиза, сначала зафиксируйте все ваши изменения (мы рекомендуем следовать [Conventional Commits](https://www.conventionalcommits.org), чтобы также воспользоваться автоматическим увеличением версии и обновлением changelog), затем запустите скрипт релиза с помощью `npm run release`.

При запуске скрипта релиза произойдет следующее:

- Сначала он запустит ваш набор тестов:
  - Запуск линтера (`npm run lint`)
  - Запуск модульных, интеграционных и e2e тестов (`npm run test`)
  - Сборка модуля (`npm run prepack`)
- Затем, если ваш набор тестов прошел успешно, он приступит к публикации вашего модуля:
  - Увеличение версии вашего модуля и генерация changelog в соответствии с вашими Conventional Commits
  - Публикация модуля в npm (для этой цели модуль будет собран снова, чтобы убедиться, что его обновленный номер версии учтен в опубликованном артефакте)
  - Отправка git тега, представляющего новую опубликованную версию, в ваш удаленный git origin

::tip
Как и с другими скриптами, не стесняйтесь настроить стандартный скрипт `release` в вашем `package.json`, чтобы лучше соответствовать вашим потребностям.
::

<translated_markdown>
## Разработка модулей

Модули Nuxt поставляются с множеством мощных API и паттернов, позволяющих им изменять приложение Nuxt практически любым возможным способом. Этот раздел научит вас, как воспользоваться этими возможностями.

### Анатомия модуля

Мы можем рассмотреть два типа модулей Nuxt:

- опубликованные модули распространяются через npm - вы можете увидеть список некоторых модулей сообщества на [сайте Nuxt](/modules).
- "локальные" модули, они существуют внутри самого проекта Nuxt, либо [встроенные в конфигурацию Nuxt](/docs/api/nuxt-config#modules), либо как часть [директории `modules`](/docs/guide/directory-structure/modules).

В любом случае их анатомия схожа.

#### Определение модуля

::note
При использовании стартера определение вашего модуля доступно в `src/module.ts`.
::

Определение модуля является точкой входа вашего модуля. Это то, что загружается Nuxt, когда ваш модуль указан в конфигурации Nuxt.

На низком уровне определение модуля Nuxt - это простая, потенциально асинхронная функция, принимающая встроенные пользовательские опции и объект `nuxt` для взаимодействия с Nuxt.

```ts
export default function (inlineOptions, nuxt) {
  // Здесь вы можете делать все, что захотите..
  console.log(inlineOptions.token) // `123`
  console.log(nuxt.options.dev) // `true` или `false`
  nuxt.hook('ready', async nuxt => {
    console.log('Nuxt готов')
  })
}
```

Вы можете получить поддержку подсказок типов для этой функции, используя помощник более высокого уровня `defineNuxtModule`, предоставляемый [Nuxt Kit](/docs/guide/going-further/kit).

```ts
import { defineNuxtModule } from '@nuxt/kit'

export default defineNuxtModule((options, nuxt) => {
  nuxt.hook('pages:extend', pages => {
    console.log(`Обнаружено ${pages.length} страниц`)
  })
})
```

Однако **мы не рекомендуем** использовать это определение функции низкого уровня. Вместо этого, для определения модуля **мы рекомендуем** использовать объектный синтаксис со свойством `meta` для идентификации вашего модуля, особенно при публикации в npm.

Этот помощник делает написание модулей Nuxt более простым, реализуя множество общих паттернов, необходимых модулям, гарантируя будущую совместимость и улучшая опыт как для авторов модулей, так и для пользователей.

```ts
import { defineNuxtModule } from '@nuxt/kit'

export default defineNuxtModule({
  meta: {
    // Обычно имя npm пакета вашего модуля
    name: '@nuxtjs/example',
    // Ключ в `nuxt.config`, который содержит опции вашего модуля
    configKey: 'sample',
    // Ограничения совместимости
    compatibility: {
      // Semver версия поддерживаемых версий nuxt
      nuxt: '>=3.0.0'
    }
  },
  // Опции конфигурации по умолчанию для вашего модуля, также может быть функцией, возвращающей их
  defaults: {},
  // Сокращенный синтаксис для регистрации хуков Nuxt
  hooks: {},
  // Функция, содержащая логику вашего модуля, может быть асинхронной
  setup(moduleOptions, nuxt) {
    // ...
  }
})
```

В конечном итоге `defineNuxtModule` возвращает функцию-обертку с сигнатурой модуля более низкого уровня `(inlineOptions, nuxt)`. Эта функция-обертка применяет значения по умолчанию и другие необходимые шаги перед вызовом вашей функции `setup`:

- Поддержка `defaults` и `meta.configKey` для автоматического слияния опций модуля
- Подсказки типов и автоматический вывод типов
- Добавление прокладок для базовой совместимости с Nuxt 2
- Обеспечение установки модуля только один раз с использованием уникального ключа, вычисленного из `meta.name` или `meta.configKey`
- Автоматическая регистрация хуков Nuxt
- Автоматическая проверка проблем совместимости на основе мета-данных модуля
- Предоставление `getOptions` и `getMeta` для внутреннего использования Nuxt
- Обеспечение обратной и прямой совместимости, пока модуль использует `defineNuxtModule` из последней версии `@nuxt/kit`
- Интеграция с инструментами сборки модулей

#### Директория runtime

::note
При использовании стартера директория runtime доступна в `src/runtime`.
::

Модули, как и все в конфигурации Nuxt, не включаются в runtime вашего приложения. Однако вы можете захотеть, чтобы ваш модуль предоставлял или внедрял runtime код в приложение, на которое он установлен. Именно это позволяет вам делать директория runtime.

Внутри директории runtime вы можете предоставить любые виды ресурсов, связанных с приложением Nuxt:
- Vue компоненты
- Composables
- [Плагины Nuxt](/docs/guide/directory-structure/plugins)

Для [серверного движка](/docs/guide/concepts/server-engine), Nitro:
- API маршруты
- Middleware
- Плагины Nitro

Или любой другой вид ресурсов, который вы хотите внедрить в приложения Nuxt пользователей:
- Таблицы стилей
- 3D модели
- Изображения
- и т.д.

Затем вы сможете внедрить все эти ресурсы в приложение из вашего [определения модуля](#module-definition).

::tip
Узнайте больше о внедрении ресурсов в [разделе рецептов](#recipes).
::

::warning
Опубликованные модули не могут использовать автоимпорты для ресурсов в своей директории runtime. Вместо этого они должны импортировать их явно из `#imports` или подобных.
:br :br
Действительно, автоимпорты не включены для файлов в `node_modules` (место, где в конечном итоге будет находиться опубликованный модуль) по соображениям производительности.
::

### Инструменты

Модули поставляются с набором первоклассных инструментов, которые помогут вам в их разработке.

#### `@nuxt/module-builder`

[Nuxt Module Builder](https://github.com/nuxt/module-builder#readme) - это инструмент сборки с нулевой конфигурацией, который берет на себя всю тяжелую работу по сборке и доставке вашего модуля. Он обеспечивает правильную совместимость артефакта сборки вашего модуля с приложениями Nuxt.

#### `@nuxt/kit`

[Nuxt Kit](/docs/guide/going-further/kit) предоставляет композиционные утилиты, помогающие вашему модулю взаимодействовать с приложениями Nuxt. Рекомендуется использовать утилиты Nuxt Kit вместо ручных альтернатив, когда это возможно, для обеспечения лучшей совместимости и читаемости кода вашего модуля.

:read-more{to="/docs/guide/going-further/kit"}

#### `@nuxt/test-utils`

[Nuxt Test Utils](/docs/getting-started/testing) - это коллекция утилит, помогающих настроить и запустить приложения Nuxt в ваших тестах модулей.

### Рецепты

Здесь вы найдете общие паттерны, используемые для создания модулей.

#### Изменение конфигурации Nuxt

Конфигурация Nuxt может быть прочитана и изменена модулями. Вот пример модуля, включающего экспериментальную функцию.

```js
import { defineNuxtModule } from '@nuxt/kit'

export default defineNuxtModule({
  setup (options, nuxt) {
    // Мы создаем объект `experimental`, если он еще не существует
    nuxt.options.experimental ||= {}
    nuxt.options.experimental.componentIslands = true
  }
})
```

Когда вам нужно обрабатывать более сложные изменения конфигурации, вы должны рассмотреть использование [defu](https://github.com/unjs/defu).

::tip{icon="i-lucide-video" to="https://vueschool.io/lessons/extending-and-altering-nuxt-configuration-and-options?friend=nuxt" target="_blank"}
Посмотрите видео Vue School об изменении конфигурации Nuxt.
::

#### Предоставление опций для runtime

Поскольку модули не являются частью runtime приложения, их опции тоже не являются. Однако во многих случаях вам может потребоваться доступ к некоторым из этих опций модуля в вашем runtime коде. Мы рекомендуем предоставлять необходимую конфигурацию, используя [`runtimeConfig`](/docs/api/nuxt-config#runtimeconfig) Nuxt.

<!-- TODO: Update after #18466 (or equivalent) -->

```js
import { defineNuxtModule } from '@nuxt/kit'
import { defu } from 'defu'

export default defineNuxtModule({
  setup (options, nuxt) {
    nuxt.options.runtimeConfig.public.myModule = defu(nuxt.options.runtimeConfig.public.myModule, {
      foo: options.foo
    })
  }
})
```

Обратите внимание, что мы используем [`defu`](https://github.com/unjs/defu) для расширения публичной runtime конфигурации, предоставляемой пользователем, вместо ее перезаписи.

Затем вы можете получить доступ к опциям вашего модуля в плагине, компоненте, приложении, как к любой другой runtime конфигурации:

```js
const options = useRuntimeConfig().public.myModule
```

::warning
Будьте осторожны, не предоставляйте никакой чувствительной конфигурации модуля в публичной runtime конфигурации, такой как приватные API ключи, поскольку они попадут в публичный бандл.
::

:read-more{to="/docs/guide/going-further/runtime-config"}

::tip{icon="i-lucide-video" to="https://vueschool.io/lessons/passing-and-exposing-module-options?friend=nuxt" target="_blank"}
Посмотрите видео Vue School о передаче и предоставлении опций модулей Nuxt.
::

#### Внедрение плагинов с `addPlugin`

Плагины - это обычный способ для модуля добавить runtime логику. Вы можете использовать утилиту `addPlugin` для их регистрации из вашего модуля.

```js
import { defineNuxtModule, addPlugin, createResolver } from '@nuxt/kit'

export default defineNuxtModule({
  setup (options, nuxt) {
    // Создаем resolver для разрешения относительных путей
    const resolver = createResolver(import.meta.url)

    addPlugin(resolver.resolve('./runtime/plugin'))
  }
})
```

:read-more{to="/docs/guide/going-further/kit"}

#### Внедрение Vue компонентов с `addComponent`

Если ваш модуль должен предоставлять Vue компоненты, вы можете использовать утилиту `addComponent`, чтобы добавить их как автоимпорты для разрешения Nuxt.

```js
import { defineNuxtModule, addComponent } from '@nuxt/kit'

export default defineNuxtModule({
  setup(options, nuxt) {
    const resolver = createResolver(import.meta.url)

    // Из директории runtime
    addComponent({
      name: 'MySuperComponent', // имя компонента для использования в vue шаблонах
      export: 'MySuperComponent', // (опционально) если компонент является именованным (а не экспортом по умолчанию)
      filePath: resolver.resolve('runtime/components/MySuperComponent.vue')
    })

    // Из библиотеки
    addComponent({
      name: 'MyAwesomeComponent', // имя компонента для использования в vue шаблонах
      export: 'MyAwesomeComponent', // (опционально) если компонент является именованным (а не экспортом по умолчанию)
      filePath: '@vue/awesome-components'
    })
  }
})
```

Альтернативно, вы можете добавить целую директорию, используя `addComponentsDir`.

```ts
import { defineNuxtModule, addComponentsDir } from '@nuxt/kit'

export default defineNuxtModule({
  setup(options, nuxt) {
    const resolver = createResolver(import.meta.url)

    addComponentsDir({
      path: resolver.resolve('runtime/components')
    })
  }
})
```

#### Внедрение composables с `addImports` и `addImportsDir`

Если ваш модуль должен предоставлять composables, вы можете использовать утилиту `addImports`, чтобы добавить их как автоимпорты для разрешения Nuxt.

```ts
import { defineNuxtModule, addImports, createResolver } from '@nuxt/kit'

export default defineNuxtModule({
  setup(options, nuxt) {
    const resolver = createResolver(import.meta.url)

    addImports({
      name: 'useComposable', // имя composable для использования
      as: 'useComposable',
      from: resolver.resolve('runtime/composables/useComposable') // путь к composable
    })
  }
})
```

Альтернативно, вы можете добавить целую директорию, используя

## Экосистема

[Экосистема модулей Nuxt](/modules) представляет более 15 миллионов ежемесячных загрузок NPM и предоставляет расширенные функциональности и интеграции с различными инструментами. Вы можете стать частью этой экосистемы!

::tip{icon="i-lucide-video" to="https://vueschool.io/lessons/exploring-nuxt-modules-ecosystem-and-module-types?friend=nuxt" target="_blank"}
Посмотрите видео Vue School о типах модулей Nuxt.
::

### Типы модулей

**Официальные модули** — это модули с префиксом (областью видимости) `@nuxt/` (например, [`@nuxt/content`](https://content.nuxtjs.org)). Они создаются и активно поддерживаются командой Nuxt. Как и в случае с фреймворком, вклад сообщества более чем приветствуется для их улучшения!

**Модули сообщества** — это модули с префиксом (областью видимости) `@nuxtjs/` (например, [`@nuxtjs/tailwindcss`](https://tailwindcss.nuxtjs.org)). Это проверенные модули, созданные и поддерживаемые участниками сообщества. Опять же, вклад приветствуется от всех желающих.

**Сторонние и другие модули сообщества** — это модули (часто) с префиксом `nuxt-`. Любой может их создать, использование этого префикса позволяет обнаруживать эти модули в npm. Это лучшая отправная точка для разработки и тестирования идеи!

**Частные или персональные модули** — это модули, созданные для ваших собственных потребностей или компании. Им не нужно следовать каким-либо правилам именования для работы с Nuxt, и они часто находятся в области видимости npm-организации (например, `@my-company/nuxt-auth`)

### Добавление вашего модуля сообщества в список

Любые модули сообщества могут быть добавлены в [список модулей](/modules). Чтобы попасть в список, [откройте issue в репозитории nuxt/modules](https://github.com/nuxt/modules/issues/new?template=module_request.yml). Команда Nuxt может помочь вам применить лучшие практики перед добавлением в список.

### Присоединение к `nuxt-modules` и `@nuxtjs/`

Перенося ваши модули в [nuxt-modules](https://github.com/nuxt-modules), всегда найдется кто-то, кто поможет, и таким образом мы можем объединить усилия для создания одного идеального решения.

Если у вас есть уже опубликованный и работающий модуль, и вы хотите передать его в `nuxt-modules`, [откройте issue в nuxt/modules](https://github.com/nuxt/modules/issues/new).

Присоединившись к `nuxt-modules`, мы можем переименовать ваш модуль сообщества под область видимости `@nuxtjs/` и предоставить поддомен (например, `my-module.nuxtjs.org`) для его документации.

<!-- ## Module Internals

Maybe just a quick section touching on "how modules work" under the hood, priority, etc. -->