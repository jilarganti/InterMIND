---
title: "Создание слоев Nuxt"
description: "Nuxt предоставляет мощную систему, которая позволяет расширять файлы по умолчанию, конфигурации и многое другое."
---

Слои Nuxt — это мощная функция, которую вы можете использовать для совместного использования и повторного применения частичных приложений Nuxt в монорепозитории, или из git-репозитория или npm-пакета. Структура слоев практически идентична стандартному приложению Nuxt, что делает их легкими для создания и поддержки.

:read-more{to="/docs/getting-started/layers"}

Минимальная директория слоя Nuxt должна содержать файл [`nuxt.config.ts`](/docs/guide/directory-structure/nuxt-config), чтобы указать, что это слой.

```ts [base/nuxt.config.ts]
export default defineNuxtConfig({})
```

Кроме того, некоторые другие файлы в директории слоя будут автоматически сканироваться и использоваться Nuxt для проекта, расширяющего этот слой.

- [`app/components/*`](/docs/guide/directory-structure/components)   - Расширяет компоненты по умолчанию
- [`app/composables/*`](/docs/guide/directory-structure/composables)  - Расширяет composables по умолчанию
- [`app/layouts/*`](/docs/guide/directory-structure/layouts)  - Расширяет макеты по умолчанию
- [`app/middleware/*`](/docs/guide/directory-structure/middleware)  - Расширяет middleware по умолчанию
- [`app/pages/*`](/docs/guide/directory-structure/pages)        - Расширяет страницы по умолчанию
- [`app/plugins/*`](/docs/guide/directory-structure/plugins)        - Расширяет плагины по умолчанию
- [`app/utils/*`](/docs/guide/directory-structure/utils)   - Расширяет утилиты по умолчанию
- [`app/app.config.ts`](/docs/guide/directory-structure/app-config)  - Расширяет конфигурацию приложения по умолчанию
- [`server/*`](/docs/guide/directory-structure/server)       - Расширяет серверные эндпоинты и middleware по умолчанию
- [`nuxt.config.ts`](/docs/guide/directory-structure/nuxt-config)- Расширяет конфигурацию nuxt по умолчанию

## Базовый пример

::code-group

  ```ts [nuxt.config.ts]
  export default defineNuxtConfig({
    extends: [
      './base'
    ]
  })
  ```

  ```vue [app.vue]
    <template>
      <BaseComponent/>
    </template>
  ```

  ```ts [base/nuxt.config.ts]
    export default defineNuxtConfig({
      // Расширение от базового nuxt.config.ts!
      app: {
        head: {
          title: 'Расширение конфигураций - это весело!',
          meta: [
            { name: 'description', content: 'Я использую функцию расширения в Nuxt!' }
          ],
        }
      }
    })
  ```

  ```vue [base/app/components/BaseComponent.vue]
    <template>
      <h1>Расширение компонентов - это весело!</h1>
    </template>
  ```

::

## Приоритет слоев

При расширении из нескольких слоев важно понимать порядок приоритетов:

1. **Слои в `extends`** - более ранние записи имеют более высокий приоритет (первый переопределяет второй)
2. **Автоматически сканируемые локальные слои** из директории `~~/layers` в алфавитном порядке (Z переопределяет A)
3. **Ваш проект** имеет наивысший приоритет в стеке - он всегда будет переопределять другие слои

Например:

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  extends: [
    './layers/base',      // Наивысший приоритет (среди extends)
    './layers/theme',     // Средний приоритет  
    './layers/custom'     // Низкий приоритет
  ]
  // Ваш проект имеет наивысший приоритет
})
```

Если у вас также есть автоматически сканируемые слои, такие как `~~/layers/a` и `~~/layers/z`, полный порядок переопределения будет: `base` > `theme` > `custom` > `z` > `a` > ваш проект.

## Стартовый шаблон

Для начала работы вы можете инициализировать слой с помощью [nuxt/starter/layer template](https://github.com/nuxt/starter/tree/layer). Это создаст базовую структуру, на основе которой вы сможете строить дальше. Выполните эту команду в терминале для начала работы:

```bash [Terminal]
npm create nuxt -- --template layer nuxt-layer
```

Следуйте инструкциям в файле README для выполнения следующих шагов.

## Публикация слоев

Вы можете публиковать и делиться слоями, используя удаленный источник или npm пакет.

### Git репозиторий

Вы можете использовать git репозиторий для совместного использования вашего Nuxt слоя. Несколько примеров:

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  extends: [
    'github:username/repoName',        // GitHub удаленный источник
    'github:username/repoName/base',   // GitHub удаленный источник в директории /base
    'github:username/repoName#dev',    // GitHub удаленный источник из ветки dev
    'github:username/repoName#v1.0.0', // GitHub удаленный источник из тега v1.0.0
    'gitlab:username/repoName',        // Пример GitLab удаленного источника
    'bitbucket:username/repoName',     // Пример Bitbucket удаленного источника
  ]
})
```

::tip
Если вы хотите расширить приватный удаленный источник, вам нужно добавить переменную окружения `GIGET_AUTH=<token>` для предоставления токена.
::

::tip
Если вы хотите расширить удаленный источник из самостоятельно размещенного экземпляра GitHub или GitLab, вам нужно указать его URL с помощью переменной окружения `GIGET_GITHUB_URL=<url>` или `GIGET_GITLAB_URL=<url>` - или настроить это напрямую с помощью [опции `auth`](https://github.com/unjs/c12#extending-config-layer-from-remote-sources) в вашем `nuxt.config`.
::

::warning
Имейте в виду, что если вы расширяете удаленный источник как слой, вы не сможете получить доступ к его зависимостям вне Nuxt. Например, если удаленный слой зависит от eslint плагина, это не будет использоваться в вашей eslint конфигурации. Это происходит потому, что эти зависимости будут расположены в специальном месте (`node_modules/.c12/layer_name/node_modules/`), которое недоступно для вашего менеджера пакетов.
::

::note
При использовании git удаленных источников, если слой имеет npm зависимости и вы хотите их установить, вы можете сделать это, указав `install: true` в опциях вашего слоя.

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  extends: [
    ['github:username/repoName', { install: true }]
  ]
})
```
::

### npm пакет

Вы можете публиковать Nuxt слои как npm пакет, который содержит файлы и зависимости, которые вы хотите расширить. Это позволяет вам делиться вашей конфигурацией с другими, использовать ее в нескольких проектах или использовать ее приватно.

Чтобы расширить из npm пакета, вам нужно убедиться, что модуль опубликован в npm и установлен в проекте пользователя как devDependency. Затем вы можете использовать имя модуля для расширения текущей nuxt конфигурации:

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  extends: [
    // Node модуль с областью видимости
    '@scope/moduleName',
    // или просто имя модуля
    'moduleName'
  ]
})
```

Чтобы опубликовать директорию слоя как npm пакет, вы хотите убедиться, что в `package.json` правильно заполнены соответствующие свойства. Это обеспечит включение файлов при публикации пакета.

```json [package.json]
{
  "name": "my-theme",
  "version": "1.0.0",
  "type": "module",
  "main": "./nuxt.config.ts",
  "dependencies": {},
  "devDependencies": {
    "nuxt": "^3.0.0"
  }
}
```

::important
Убедитесь, что любая зависимость, импортированная в слое, **явно добавлена** в `dependencies`. Зависимость `nuxt` и все, что используется только для тестирования слоя перед публикацией, должно оставаться в поле `devDependencies`.
::

Теперь вы можете приступить к публикации модуля в npm, либо публично, либо приватно.

::important
При публикации слоя как приватного npm пакета, вам нужно убедиться, что вы вошли в систему, чтобы аутентифицироваться с npm для загрузки node модуля.
::

## Советы

### Псевдонимы именованных слоев

Автоматически сканируемые слои (из вашей директории `~~/layers`) автоматически создают псевдонимы. Например, вы можете получить доступ к вашему слою `~~/layers/test` через `#layers/test`.

Если вы хотите создать псевдонимы именованных слоев для других слоев, вы можете указать имя в конфигурации слоя.

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  $meta: {
    name: 'example',
  },
})
```

Это создаст псевдоним `#layers/example`, который указывает на ваш слой.

### Относительные пути и псевдонимы

При импорте с использованием глобальных псевдонимов (таких как `~/` и `@/`) в компонентах и композаблах слоя, обратите внимание, что эти псевдонимы разрешаются относительно путей проекта пользователя. В качестве обходного решения вы можете **использовать относительные пути** для их импорта или использовать псевдонимы именованных слоев.

Также при использовании относительных путей в файле `nuxt.config` слоя (за исключением вложенных `extends`) они разрешаются относительно проекта пользователя, а не слоя. В качестве обходного решения используйте полные разрешенные пути в `nuxt.config`:

```js [nuxt.config.ts]
import { fileURLToPath } from 'url'
import { dirname, join } from 'path'

const currentDir = dirname(fileURLToPath(import.meta.url))

export default defineNuxtConfig({
  css: [
    join(currentDir, './app/assets/main.css')
  ]
})
```

## Поддержка многослойности для модулей Nuxt

Вы можете использовать внутренний массив `nuxt.options._layers` для поддержки пользовательской обработки многослойности в ваших модулях.

```ts [modules/my-module.ts]
export default defineNuxtModule({
  setup(_options, nuxt) {
    for (const layer of nuxt.options._layers) {
      // Вы можете проверить существование пользовательской директории для расширения каждого слоя
      console.log('Пользовательское расширение для', layer.cwd, layer.config)
    }
  }
})
```

**Примечания:**
- Более ранние элементы в массиве `_layers` имеют более высокий приоритет и переопределяют более поздние
- Проект пользователя является первым элементом в массиве `_layers`

## Углубленное изучение

Загрузка конфигурации и поддержка расширений обрабатывается с помощью [unjs/c12](https://github.com/unjs/c12), объединение выполняется с использованием [unjs/defu](https://github.com/unjs/defu), а удаленные git-источники поддерживаются через [unjs/giget](https://github.com/unjs/giget). Изучите документацию и исходный код, чтобы узнать больше.

::read-more{icon="i-simple-icons-github" to="https://github.com/nuxt/nuxt/issues/13367" target="_blank"}
Ознакомьтесь с нашей текущей разработкой по внедрению дополнительных улучшений для поддержки слоев на GitHub.
::