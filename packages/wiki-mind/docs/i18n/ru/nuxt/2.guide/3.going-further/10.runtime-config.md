---
title: "Конфигурация времени выполнения"
description: "Nuxt предоставляет API конфигурации времени выполнения для предоставления конфигурации и секретов в вашем приложении."
---

## Экспонирование

Чтобы предоставить конфигурацию и переменные окружения остальной части вашего приложения, вам необходимо определить конфигурацию времени выполнения в файле [`nuxt.config`](/docs/guide/directory-structure/nuxt-config), используя опцию [`runtimeConfig`](/docs/api/nuxt-config#runtimeconfig).

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  runtimeConfig: {
    // Приватные ключи, которые доступны только на стороне сервера
    apiSecret: '123',
    // Ключи внутри public также будут доступны на стороне клиента
    public: {
      apiBase: '/api'
    }
  }
})
```

При добавлении `apiBase` в `runtimeConfig.public`, Nuxt добавляет его в полезную нагрузку каждой страницы. Мы можем универсально получить доступ к `apiBase` как на сервере, так и в браузере.

```ts
const runtimeConfig = useRuntimeConfig()

console.log(runtimeConfig.apiSecret)
console.log(runtimeConfig.public.apiBase)
```

::tip
Публичная конфигурация времени выполнения доступна в шаблонах Vue через `$config.public`.
::

### Сериализация

Ваша конфигурация времени выполнения будет сериализована перед передачей в Nitro. Это означает, что все, что не может быть сериализовано и затем десериализовано (например, функции, Sets, Maps и так далее), не должно устанавливаться в вашем `nuxt.config`.

Вместо передачи несериализуемых объектов или функций в ваше приложение из `nuxt.config`, вы можете поместить этот код в плагин или middleware Nuxt или Nitro.

### Переменные окружения

Наиболее распространенный способ предоставления конфигурации - использование [переменных окружения](https://medium.com/chingu/an-introduction-to-environment-variables-and-how-to-use-them-f602f66d15fa).

::note
Nuxt CLI имеет встроенную поддержку чтения вашего файла `.env` в режиме разработки, сборки и генерации. Но когда вы запускаете собранный сервер, **ваш файл `.env` не будет прочитан**.
:read-more{to="/docs/guide/directory-structure/env"}
::

Значения конфигурации времени выполнения **автоматически заменяются соответствующими переменными окружения во время выполнения**.

Есть два ключевых требования:

1. Ваши желаемые переменные должны быть определены в вашем `nuxt.config`. Это гарантирует, что произвольные переменные окружения не будут доступны коду вашего приложения.

1. Только специально именованная переменная окружения может переопределить свойство конфигурации времени выполнения. То есть переменная окружения в верхнем регистре, начинающаяся с `NUXT_`, которая использует `_` для разделения ключей и изменений регистра.

::warning
Установка значения по умолчанию для `runtimeConfig` в *переменные окружения с другими именами* (например, установка `myVar` в `process.env.OTHER_VARIABLE`) будет работать только во время сборки и сломается во время выполнения.
Рекомендуется использовать переменные окружения, которые соответствуют структуре вашего объекта `runtimeConfig`.
::

::tip{icon="i-lucide-video" to="https://youtu.be/_FYV5WfiWvs" target="_blank"}
Посмотрите видео от Alexander Lichter, демонстрирующее главную ошибку, которую делают разработчики при использовании runtimeConfig.
::

#### Пример

```ini [.env]
NUXT_API_SECRET=api_secret_token
NUXT_PUBLIC_API_BASE=https://nuxtjs.org
```

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  runtimeConfig: {
    apiSecret: '', // может быть переопределено переменной окружения NUXT_API_SECRET
    public: {
      apiBase: '', // может быть переопределено переменной окружения NUXT_PUBLIC_API_BASE
    }
  },
})
```

## Чтение

### Vue приложение

В Vue части вашего Nuxt приложения вам нужно будет вызвать [`useRuntimeConfig()`](/docs/api/composables/use-runtime-config) для доступа к конфигурации времени выполнения.

::important
Поведение отличается между клиентской и серверной стороной:

- На клиентской стороне доступны только ключи в `runtimeConfig.public` и `runtimeConfig.app` (который используется Nuxt внутренне), и объект является как записываемым, так и реактивным.

- На серверной стороне доступна вся конфигурация времени выполнения, но она доступна только для чтения, чтобы избежать совместного использования контекста.
::

```vue [pages/index.vue]
<script setup lang="ts">
const config = useRuntimeConfig()

console.log('Конфигурация времени выполнения:', config)
if (import.meta.server) {
  console.log('API секрет:', config.apiSecret)
}
</script>

<template>
  <div>
    <div>Проверьте консоль разработчика!</div>
  </div>
</template>
```

::caution
**Примечание по безопасности:** Будьте осторожны, чтобы не раскрыть ключи конфигурации времени выполнения на клиентской стороне, отображая их или передавая в `useState`.
::

### Плагины

Если вы хотите использовать конфигурацию времени выполнения в любом (пользовательском) плагине, вы можете использовать [`useRuntimeConfig()`](/docs/api/composables/use-runtime-config) внутри вашей функции `defineNuxtPlugin`.

```ts [plugins/config.ts]
export default defineNuxtPlugin((nuxtApp) => {
  const config = useRuntimeConfig()

  console.log('Базовый URL API:', config.public.apiBase)
});
```

### Серверные маршруты

Вы также можете получить доступ к конфигурации времени выполнения в серверных маршрутах, используя `useRuntimeConfig`.

```ts [server/api/test.ts]
export default defineEventHandler(async (event) => {
  const { apiSecret } = useRuntimeConfig(event)
  const result = await $fetch('https://my.api.com/test', {
    headers: {
      Authorization: `Bearer ${apiSecret}`
    }
  })
  return result
})
```

::note
Передача `event` в качестве аргумента в `useRuntimeConfig` необязательна, но рекомендуется передавать его, чтобы получить конфигурацию времени выполнения, переопределенную [переменными окружения](/docs/guide/going-further/runtime-config#environment-variables) во время выполнения для серверных маршрутов.
::

## Типизация конфигурации времени выполнения

Nuxt пытается автоматически сгенерировать typescript интерфейс из предоставленной конфигурации времени выполнения, используя [unjs/untyped](https://github.com/unjs/untyped).

Но также возможно типизировать конфигурацию времени выполнения вручную:

```ts [index.d.ts]
declare module 'nuxt/schema' {
  interface RuntimeConfig {
    apiSecret: string
  }
  interface PublicRuntimeConfig {
    apiBase: string
  }
}
// Всегда важно убедиться, что вы импортируете/экспортируете что-то при расширении типа
export {}
```

::note
`nuxt/schema` предоставляется для удобства конечных пользователей для доступа к версии схемы, используемой Nuxt в их проекте. Авторы модулей должны вместо этого расширять `@nuxt/schema`.
::