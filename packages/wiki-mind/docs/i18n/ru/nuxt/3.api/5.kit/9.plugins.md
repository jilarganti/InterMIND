---
title: "Плагины"
description: "Nuxt Kit предоставляет набор утилит для создания и использования плагинов. Вы можете добавлять плагины или шаблоны плагинов в свой модуль с помощью этих функций."
links:
  - label: Source
    icon: i-simple-icons-github
    to: https://github.com/nuxt/nuxt/blob/main/packages/kit/src/plugin.ts
    size: xs
---

Плагины представляют собой автономный код, который обычно добавляет функциональность на уровне приложения в Vue. В Nuxt плагины автоматически импортируются из директории `plugins/`. Однако, если вам нужно поставлять плагин вместе с вашим модулем, Nuxt Kit предоставляет методы `addPlugin` и `addPluginTemplate`. Эти утилиты позволяют настроить конфигурацию плагина для лучшего соответствия вашим потребностям.

## `addPlugin`

Регистрирует плагин Nuxt и добавляет его в массив плагинов.

::tip{icon="i-lucide-video" to="https://vueschool.io/lessons/injecting-plugins?friend=nuxt" target="_blank"}
Посмотрите видео Vue School о `addPlugin`.
::

### Использование

```ts twoslash
import { addPlugin, createResolver, defineNuxtModule } from '@nuxt/kit'

export default defineNuxtModule({
  setup () {
    const { resolve } = createResolver(import.meta.url)

    addPlugin({
      src: resolve('runtime/plugin.js'),
      mode: 'client',
    })
  },
})
```

### Тип

```ts
function addPlugin(plugin: NuxtPlugin | string, options?: AddPluginOptions): NuxtPlugin
```

### Параметры

**`plugin`**: Объект плагина или строка с путем к плагину. Если передана строка, она будет преобразована в объект плагина со свойством `src`, установленным в значение строки.

Если передан объект плагина, он должен иметь следующие свойства:

| Свойство | Тип                                        | Обязательно | Описание                                                                                                                                                                                                                                                                                                                                                                 |
| -------- | ------------------------------------------ | ----------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `src`    | `string`                                   | `true`      | Путь к файлу плагина.                                                                                                                                                                                                                                                                                                                                                   |
| `mode`   | `'all' \| 'server' \| 'client'`{lang="ts"} | `false`     | Если установлено в `'all'`, плагин будет включен как в клиентские, так и в серверные сборки. Если установлено в `'server'`, плагин будет включен только в серверную сборку. Если установлено в `'client'`, плагин будет включен только в клиентскую сборку. Вы также можете использовать модификаторы `.client` и `.server` при указании опции `src` для использования плагина только на клиентской или серверной стороне. |
| `order`  | `number`                                   | `false`     | Порядок плагина. Это позволяет более детально контролировать порядок плагинов и должно использоваться только опытными пользователями. Меньшие числа выполняются первыми, а пользовательские плагины по умолчанию имеют значение `0`. Рекомендуется устанавливать `order` в число между `-20` для `pre`-плагинов (плагины, которые выполняются до плагинов Nuxt) и `20` для `post`-плагинов (плагины, которые выполняются после плагинов Nuxt). |

::warning
Избегайте использования `order`, если это не необходимо. Используйте `append`, если вам просто нужно зарегистрировать плагины после настроек Nuxt по умолчанию.
::

**`options`**: Необязательный объект со следующими свойствами:

| Свойство | Тип       | Обязательно | Описание                                                                                                                    |
| -------- | --------- | ----------- | --------------------------------------------------------------------------------------------------------------------------- |
| `append` | `boolean` | `false`     | Если `true`, плагин будет добавлен в конец массива плагинов. Если `false`, он будет добавлен в начало. По умолчанию `false`. |

### Примеры

::code-group

```ts [module.ts]
import { addPlugin, createResolver, defineNuxtModule } from '@nuxt/kit'

export default defineNuxtModule({
  setup () {
    const { resolve } = createResolver(import.meta.url)

    addPlugin({
      src: resolve('runtime/plugin.js'),
      mode: 'client',
    })
  },
})
```

```ts [runtime/plugin.ts]
export default defineNuxtPlugin((nuxtApp) => {
  const colorMode = useColorMode()

  nuxtApp.hook('app:mounted', () => {
    if (colorMode.preference !== 'dark') {
      colorMode.preference = 'dark'
    }
  })
})
```

::

## `addPluginTemplate`

Добавляет шаблон и регистрирует его как плагин nuxt. Это полезно для плагинов, которым необходимо генерировать код во время сборки.

::tip{icon="i-lucide-video" to="https://vueschool.io/lessons/injecting-plugin-templates?friend=nuxt" target="_blank"}
Посмотрите видео Vue School о `addPluginTemplate`.
::

### Использование

```ts twoslash
import { addPluginTemplate, defineNuxtModule } from '@nuxt/kit'

export default defineNuxtModule({
  setup (options) {
    addPluginTemplate({
      filename: 'module-plugin.mjs',
      getContents: () => `import { defineNuxtPlugin } from '#app/nuxt'
export default defineNuxtPlugin({
  name: 'module-plugin',
  setup (nuxtApp) {
    ${options.log ? 'console.log("Plugin install")' : ''}
  }
})`,
    })
  },
})
```

### Тип

```ts
function addPluginTemplate(pluginOptions: NuxtPluginTemplate, options?: AddPluginOptions): NuxtPlugin
```

### Параметры

**`pluginOptions`**: Объект шаблона плагина со следующими свойствами:

| Свойство      | Тип                                                                   | Обязательно | Описание                                                                                                                                                                                                                                                                                                                                                                 |
| ------------- | --------------------------------------------------------------------- | ----------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `src`         | `string`                                                              | `false`     | Путь к шаблону. Если `src` не предоставлен, вместо него должен быть предоставлен `getContents`.                                                                                                                                                                                                                                                                          |
| `filename`    | `string`                                                              | `false`     | Имя файла шаблона. Если `filename` не предоставлено, оно будет сгенерировано из пути `src`. В этом случае опция `src` обязательна.                                                                                                                                                                                                                                       |
| `dst`         | `string`                                                              | `false`     | Путь к файлу назначения. Если `dst` не предоставлен, он будет сгенерирован из пути `filename` и опции nuxt `buildDir`.                                                                                                                                                                                                                                                   |
| `mode`        | `'all' \| 'server' \| 'client'`{lang="ts"}                            | `false`     | Если установлено в `'all'`, плагин будет включен как в клиентские, так и в серверные сборки. Если установлено в `'server'`, плагин будет включен только в серверную сборку. Если установлено в `'client'`, плагин будет включен только в клиентскую сборку. Вы также можете использовать модификаторы `.client` и `.server` при указании опции `src` для использования плагина только на клиентской или серверной стороне. |
| `options`     | `Record<string, any>`{lang="ts"}                                      | `false`     | Опции для передачи в шаблон.                                                                                                                                                                                                                                                                                                                                             |
| `getContents` | `(data: Record<string, any>) => string \| Promise<string>`{lang="ts"} | `false`     | Функция, которая будет вызвана с объектом `options`. Она должна возвращать строку или промис, который разрешается в строку. Если предоставлен `src`, эта функция будет проигнорирована.                                                                                                                                                                                  |
| `write`       | `boolean`                                                             | `false`     | Если установлено в `true`, шаблон будет записан в файл назначения. В противном случае шаблон будет использоваться только в виртуальной файловой системе.                                                                                                                                                                                                                 |
| `order`       | `number`                                                              | `false`     | Порядок плагина. Это позволяет более детально контролировать порядок плагинов и должно использоваться только продвинутыми пользователями. Меньшие числа выполняются первыми, а пользовательские плагины по умолчанию имеют значение `0`. Рекомендуется устанавливать `order` в число между `-20` для `pre`-плагинов (плагины, которые выполняются до плагинов Nuxt) и `20` для `post`-плагинов (плагины, которые выполняются после плагинов Nuxt). |

::warning
Предпочитайте использование `getContents` для динамической генерации плагинов. Избегайте установки `order`, если это не необходимо.
::

**`options`**: Необязательный объект со следующими свойствами:

| Свойство | Тип       | Обязательно | Описание                                                                                                                    |
| -------- | --------- | ----------- | --------------------------------------------------------------------------------------------------------------------------- |
| `append` | `boolean` | `false`     | Если `true`, плагин будет добавлен в конец массива плагинов. Если `false`, он будет добавлен в начало. По умолчанию `false`. |

### Примеры

#### Генерация шаблона плагина с различными опциями

Используйте `addPluginTemplate`, когда вам нужно динамически генерировать код плагина во время сборки. Это позволяет генерировать различное содержимое плагина на основе переданных ему опций. Например, Nuxt внутренне использует эту функцию для генерации конфигураций Vue приложения.

```ts twoslash [module.ts]
import { addPluginTemplate, defineNuxtModule } from '@nuxt/kit'

export default defineNuxtModule({
  setup (_, nuxt) {
    if (nuxt.options.vue.config && Object.values(nuxt.options.vue.config).some(v => v !== null && v !== undefined)) {
      addPluginTemplate({
        filename: 'vue-app-config.mjs',
        write: true,
        getContents: () => `import { defineNuxtPlugin } from '#app/nuxt'
export default defineNuxtPlugin({
  name: 'nuxt:vue-app-config',
  enforce: 'pre',
  setup (nuxtApp) {
    ${Object.keys(nuxt.options.vue.config!)
        .map(k => `nuxtApp.vueApp.config[${JSON.stringify(k)}] = ${JSON.stringify(nuxt.options.vue.config![k as 'idPrefix'])}`)
        .join('\n')
    }
  }
})`,
      })
    }
  },
})
```

Это генерирует различный код плагина в зависимости от предоставленной конфигурации.

::code-group

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  vue: {
    config: {
      idPrefix: 'nuxt',
    },
  },
})
```

```ts [#build/vue-app-config.mjs]
import { defineNuxtPlugin } from '#app/nuxt'
export default defineNuxtPlugin({
  name: 'nuxt:vue-app-config',
  enforce: 'pre',
  setup (nuxtApp) {
    nuxtApp.vueApp.config["idPrefix"] = "nuxt"
  }
})
```

::