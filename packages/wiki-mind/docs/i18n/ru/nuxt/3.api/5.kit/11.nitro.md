---
title: "Nitro"
description: "Nuxt Kit предоставляет набор утилит для работы с Nitro. Эти функции позволяют добавлять серверные обработчики, плагины и маршруты для предварительного рендеринга."
links:
  - label: Source
    icon: i-simple-icons-github
    to: https://github.com/nuxt/nuxt/blob/main/packages/kit/src/nitro.ts
    size: xs
---

Nitro — это фреймворк с открытым исходным кодом на TypeScript для создания сверхбыстрых веб-серверов. Nuxt использует Nitro в качестве серверного движка. Вы можете использовать `useNitro` для доступа к экземпляру Nitro, `addServerHandler` для добавления серверного обработчика, `addDevServerHandler` для добавления серверного обработчика, который будет использоваться только в режиме разработки, `addServerPlugin` для добавления плагина, расширяющего поведение Nitro во время выполнения, и `addPrerenderRoutes` для добавления маршрутов, которые будут предварительно отрендерены Nitro.

## `addServerHandler`

Добавляет обработчик сервера Nitro. Используйте это, если вы хотите создать серверное промежуточное ПО или пользовательский маршрут.

### Использование

```ts twoslash
import { createResolver, defineNuxtModule, addServerHandler } from '@nuxt/kit'

export default defineNuxtModule({
  setup(options) {
    const { resolve } = createResolver(import.meta.url)

    addServerHandler({
      route: '/robots.txt',
      handler: resolve('./runtime/robots.get')
    })
  }
})
```

### Тип

```ts
function addServerHandler (handler: NitroEventHandler): void
```

### Параметры

**handler**: Объект обработчика со следующими свойствами:

| Свойство    | Тип             | Обязательно | Описание                                                                                                        |
| ----------- | --------------- | ----------- | --------------------------------------------------------------------------------------------------------------- |
| `handler`   | `string`        | `true`      | Путь к обработчику событий.                                                                                     |
| `route`     | `string`        | `false`     | Префикс пути или маршрут. Если используется пустая строка, будет использоваться как промежуточное ПО.          |
| `middleware`| `boolean`       | `false`     | Указывает, что это обработчик промежуточного ПО. Промежуточное ПО вызывается на каждом маршруте и обычно должно ничего не возвращать, чтобы передать управление следующим обработчикам. |
| `lazy`      | `boolean`       | `false`     | Использовать ленивую загрузку для импорта обработчика. Это полезно, когда вы хотите загружать обработчик только по требованию. |
| `method`    | `string`        | `false`     | Сопоставитель метода маршрутизатора. Если имя обработчика содержит имя метода, оно будет использоваться как значение по умолчанию. |

### Примеры

#### Базовое использование

Вы можете использовать `addServerHandler` для добавления обработчика сервера из вашего модуля.

::code-group

```ts twoslash [module.ts]
import { createResolver, defineNuxtModule, addServerHandler } from '@nuxt/kit'

export default defineNuxtModule({
  setup(options) {
    const { resolve } = createResolver(import.meta.url)

    addServerHandler({
      route: '/robots.txt',
      handler: resolve('./runtime/robots.get')
    })
  }
})
```

```ts twoslash [runtime/robots.get.ts]
export default defineEventHandler(() => {
  return {
    body: `User-agent: *\nDisallow: /`
  }
})
```

::

Когда вы обращаетесь к `/robots.txt`, он вернет следующий ответ:

```txt
User-agent: *
Disallow: /
```

## `addDevServerHandler`

Добавляет обработчик сервера Nitro для использования только в режиме разработки. Этот обработчик будет исключен из продакшн сборки.

### Использование

```ts twoslash
import { defineEventHandler } from 'h3'
import { createResolver, defineNuxtModule, addDevServerHandler } from '@nuxt/kit'

export default defineNuxtModule({
  setup() {
    addDevServerHandler({
      handler: defineEventHandler(() => {
        return {
          body: `Ответ сгенерирован в ${new Date().toISOString()}`
        }
      }),
      route: '/_handler'
    })
  }
})
```

### Тип

```ts twoslash
// @errors: 2391
import type { NitroDevEventHandler } from 'nitropack/types'
// ---cut---
function addDevServerHandler (handler: NitroDevEventHandler): void
```

### Параметры

**handler**: Объект обработчика со следующими свойствами:

| Свойство    | Тип             | Обязательно | Описание                                                                                                        |
| ----------- | --------------- | ----------- | --------------------------------------------------------------------------------------------------------------- |
| `handler`   | `EventHandler`  | `true`      | Обработчик событий.                                                                                             |
| `route`     | `string`        | `false`     | Префикс пути или маршрут. Если используется пустая строка, будет использоваться как middleware.                 |

### Примеры

#### Базовое использование

В некоторых случаях вы можете захотеть создать обработчик сервера специально для целей разработки, например, просмотрщик конфигурации Tailwind.

```ts
import { joinURL } from 'ufo'
import { defineNuxtModule, addDevServerHandler } from '@nuxt/kit'

export default defineNuxtModule({
  async setup(options, nuxt) {
    const route = joinURL(nuxt.options.app?.baseURL, '/_tailwind')

    // @ts-ignore
    const createServer = await import('tailwind-config-viewer/server/index.js').then(r => r.default || r) as any
    const viewerDevMiddleware = createServer({ tailwindConfigProvider: () => options, routerPrefix: route }).asMiddleware()

    addDevServerHandler({ route, handler: viewerDevMiddleware })
  }
})
```

## `useNitro`

Возвращает экземпляр Nitro.

::warning
Вы можете вызвать `useNitro()` только после хука `ready`.
::

::note
Изменения в конфигурации экземпляра Nitro не применяются.
::

### Использование

```ts
import { defineNuxtModule, useNitro } from '@nuxt/kit'

export default defineNuxtModule({
  setup(options, nuxt) {
    const resolver = createResolver(import.meta.url)

    nuxt.hook('ready', () => {
      const nitro = useNitro()
      // Делаем что-то с экземпляром Nitro
    })
  }
})
```

### Тип

```ts
function useNitro (): Nitro
```

## `addServerPlugin`

Добавить плагин для расширения поведения Nitro во время выполнения.

::tip
Вы можете узнать больше о плагинах Nitro в [документации Nitro](https://nitro.build/guide/plugins).
::

### Использование

```ts twoslash
import { createResolver, defineNuxtModule, addServerPlugin } from '@nuxt/kit'

export default defineNuxtModule({
  setup() {
    const { resolve } = createResolver(import.meta.url)
    addServerPlugin(resolve('./runtime/plugin.ts'))
  }
})
```

### Тип

```ts
function addServerPlugin (plugin: string): void
```

### Параметры

| Свойство    | Тип             | Обязательно | Описание                                                                                                        |
| ----------- | --------------- | ----------- | --------------------------------------------------------------------------------------------------------------- |
| `plugin`    | `string`        | `true`      | Путь к плагину. Плагин должен экспортировать функцию по умолчанию, которая принимает экземпляр Nitro в качестве аргумента. |

### Примеры

::code-group

```ts [module.ts]
import { createResolver, defineNuxtModule, addServerPlugin } from '@nuxt/kit'

export default defineNuxtModule({
  setup() {
    const { resolve } = createResolver(import.meta.url)
    addServerPlugin(resolve('./runtime/plugin.ts'))
  }
})
```

```ts [runtime/plugin.ts]
export default defineNitroPlugin((nitroApp) => {
  nitroApp.hooks.hook("request", (event) => {
    console.log("on request", event.path);
  });

  nitroApp.hooks.hook("beforeResponse", (event, { body }) => {
    console.log("on response", event.path, { body });
  });

  nitroApp.hooks.hook("afterResponse", (event, { body }) => {
    console.log("on after response", event.path, { body });
  });
});
```

::

## `addPrerenderRoutes`

Добавить маршруты для предварительного рендеринга в Nitro.

### Использование

```ts
import { defineNuxtModule, addPrerenderRoutes } from '@nuxt/kit'

export default defineNuxtModule({
  meta: {
    name: 'nuxt-sitemap',
    configKey: 'sitemap',
  },
  defaults: {
    sitemapUrl: '/sitemap.xml',
    prerender: true,
  },
  setup(options) {
    if (options.prerender) {
      addPrerenderRoutes(options.sitemapUrl)
    }
  }
})
```

### Тип

```ts
function addPrerenderRoutes (routes: string | string[]): void
```

### Параметры

| Свойство    | Тип                             | Обязательно | Описание                                       |
| ----------- | ------------------------------- | ----------- | ---------------------------------------------- |
| `routes`    | `string \| string[]`{lang="ts"} | `true`      | Маршрут или массив маршрутов для предварительного рендеринга. |

## `addServerImports`

Добавляет импорты на сервер. Делает ваши импорты доступными в Nitro без необходимости импортировать их вручную.

### Использование

```ts twoslash
import { defineNuxtModule, createResolver, addServerImports } from '@nuxt/kit'

export default defineNuxtModule({
  setup(options) {
    const names = [
      'useStoryblok',
      'useStoryblokApi',
      'useStoryblokBridge',
      'renderRichText',
      'RichTextSchema'
    ]

    names.forEach((name) =>
      addServerImports({ name, as: name, from: '@storyblok/vue' })
    )
  }
})
```

### Тип

```ts
function addServerImports (dirs: Import | Import[]): void
```

### Параметры

`imports`: Объект или массив объектов со следующими свойствами:

| Свойство           | Тип                          | Обязательно | Описание                                                                                                        |
| ------------------ | ---------------------------- | ----------- | --------------------------------------------------------------------------------------------------------------- |
| `name`             | `string`                     | `true`      | Имя импорта для обнаружения.                                                                                   |
| `from`             | `string`                     | `true`      | Спецификатор модуля для импорта.                                                                               |
| `priority`         | `number`                     | `false`     | Приоритет импорта; если несколько импортов имеют одинаковое имя, будет использован тот, у которого выше приоритет. |
| `disabled`         | `boolean`                    | `false`     | Отключен ли этот импорт.                                                                                        |
| `meta`             | `Record<string, any>`        | `false`     | Метаданные импорта.                                                                                             |
| `type`             | `boolean`                    | `false`     | Является ли этот импорт чистым импортом типа.                                                                   |
| `typeFrom`         | `string`                     | `false`     | Использовать это как значение `from` при генерации объявлений типов.                                           |
| `as`               | `string`                     | `false`     | Импортировать под этим именем.                                                                                  |

## `addServerImportsDir`

Добавить директорию для сканирования автоимпортов Nitro.

### Использование

```ts twoslash
import { defineNuxtModule, createResolver, addServerImportsDir } from '@nuxt/kit'

export default defineNuxtModule({
  meta: {
    name: 'my-module',
    configKey: 'myModule',
  },
  setup(options) {
    const { resolve } = createResolver(import.meta.url)
    addServerImportsDir(resolve('./runtime/server/composables'))
  }
})
```

### Тип

```ts
function addServerImportsDir (dirs: string | string[], opts: { prepend?: boolean }): void
```

### Параметры

| Свойство    | Тип                             | Обязательный | Описание                                       |
| ----------- | ------------------------------- | ------------ | ---------------------------------------------- |
| `dirs`      | `string \| string[]`{lang="ts"} | `true`       | Директория или массив директорий для регистрации сканирования Nitro. |
| `opts`      | `{ prepend?: boolean }`         | `false`      | Опции для директории импорта. Если `prepend` равно `true`, директория добавляется в начало списка сканирования. |

### Примеры

Вы можете использовать `addServerImportsDir` для добавления директории для сканирования Nitro. Это полезно, когда вы хотите, чтобы Nitro автоматически импортировал функции из пользовательской серверной директории.

::code-group

```ts twoslash [module.ts]
import { defineNuxtModule, createResolver, addServerImportsDir } from '@nuxt/kit'

export default defineNuxtModule({
  meta: {
    name: 'my-module',
    configKey: 'myModule',
  },
  setup(options) {
    const { resolve } = createResolver(import.meta.url)
    addServerImportsDir(resolve('./runtime/server/composables'))
  }
})
```

```ts twoslash [runtime/server/composables/index.ts]
export function useApiSecret() {
  const { apiSecret } = useRuntimeConfig()
  return apiSecret
}
```

::

Затем вы можете использовать функцию `useApiSecret` в вашем серверном коде:

```ts twoslash [runtime/server/api/hello.ts]
const useApiSecret = (): string => ''
// ---cut---
export default defineEventHandler(() => {
  const apiSecret = useApiSecret()
  // Делаем что-то с apiSecret
})
```

## `addServerScanDir`

Добавляет директории для сканирования Nitro. Он будет проверять поддиректории, которые будут зарегистрированы
так же, как папка `~/server`.

::note
Сканируются только `~/server/api`, `~/server/routes`, `~/server/middleware` и `~/server/utils`.
::

### Использование

```ts twoslash
import { defineNuxtModule, createResolver, addServerScanDir } from '@nuxt/kit'

export default defineNuxtModule({
  meta: {
    name: 'my-module',
    configKey: 'myModule',
  },
  setup(options) {
    const { resolve } = createResolver(import.meta.url)
    addServerScanDir(resolve('./runtime/server'))
  }
})
```

### Тип

```ts
function addServerScanDir (dirs: string | string[], opts: { prepend?: boolean }): void
```

### Параметры

| Свойство    | Тип                             | Обязательный | Описание                                    |
| ----------- | ------------------------------- | ------------ | ------------------------------------------- |
| `dirs`      | `string \| string[]`{lang="ts"} | `true`       | Директория или массив директорий для регистрации для сканирования Nitro как серверные директории. |
| `opts`      | `{ prepend?: boolean }`         | `false`      | Опции для директории импорта. Если `prepend` равно `true`, директория добавляется в начало списка сканирования. |

### Примеры

Вы можете использовать `addServerScanDir` для добавления директории для сканирования Nitro. Это полезно, когда вы хотите добавить пользовательскую серверную директорию.

::code-group

```ts twoslash [module.ts]
import { defineNuxtModule, createResolver, addServerScanDir } from '@nuxt/kit'

export default defineNuxtModule({
  meta: {
    name: 'my-module',
    configKey: 'myModule',
  },
  setup(options) {
    const { resolve } = createResolver(import.meta.url)
    addServerScanDir(resolve('./runtime/server'))
  }
})
```

```ts twoslash [runtime/server/utils/index.ts]
export function hello() {
  return 'Hello from server utils!'
}
```
::

Затем вы можете использовать функцию `hello` в вашем серверном коде.

```ts twoslash [runtime/server/api/hello.ts]
function hello() {
  return 'Hello from server utils!'
}
// ---cut---
export default defineEventHandler(() => {
  return hello() // Hello from server utils!
})
```