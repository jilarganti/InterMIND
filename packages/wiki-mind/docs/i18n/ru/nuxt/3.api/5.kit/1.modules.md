---
title: "Модули"
description: "Nuxt Kit предоставляет набор утилит для создания и использования модулей. Вы можете использовать эти утилиты для создания собственных модулей или повторного использования существующих модулей."
links:
  - label: Source
    icon: i-simple-icons-github
    to: https://github.com/nuxt/nuxt/blob/main/packages/kit/src/module
    size: xs
---

Модули являются строительными блоками Nuxt. Kit предоставляет набор утилит для создания и использования модулей. Вы можете использовать эти утилиты для создания собственных модулей или повторного использования существующих модулей. Например, вы можете использовать функцию `defineNuxtModule` для определения модуля и функцию `installModule` для программной установки модуля.

## `defineNuxtModule`

Определите Nuxt модуль, автоматически объединяя значения по умолчанию с опциями, предоставленными пользователем, устанавливая любые предоставленные хуки и вызывая дополнительную функцию настройки для полного контроля.

### Использование

```ts twoslash
import { defineNuxtModule } from '@nuxt/kit'

export default defineNuxtModule({
  meta: {
    name: 'my-module',
    configKey: 'myModule'
  },
  defaults: {
    enabled: true
  },
  setup (options) {
    if (options.enabled) {
      console.log('Мой Nuxt модуль включен!')
    }
  }
})
```

### Тип

```ts twoslash
// @errors: 2391
import type { ModuleDefinition, ModuleOptions, NuxtModule } from '@nuxt/schema'
// ---cut---
export function defineNuxtModule<TOptions extends ModuleOptions> (
  definition?: ModuleDefinition<TOptions, Partial<TOptions>, false> | NuxtModule<TOptions, Partial<TOptions>, false>,
): NuxtModule<TOptions, TOptions, false>

export function defineNuxtModule<TOptions extends ModuleOptions> (): {
  with: <TOptionsDefaults extends Partial<TOptions>> (
    definition: ModuleDefinition<TOptions, TOptionsDefaults, true> | NuxtModule<TOptions, TOptionsDefaults, true>
  ) => NuxtModule<TOptions, TOptionsDefaults, true>
}
```

### Параметры

**definition**: Объект определения модуля или функция модуля. Объект определения модуля должен содержать следующие свойства:

| Свойство           | Тип                                                                 | Обязательно | Описание                                                                                                     |
| ------------------ | -------------------------------------------------------------------- | -------- | --------------------------------------------------------------------------------------------------------------- |
| `meta`             | `ModuleMeta`                                                         | `false`  | Метаданные модуля. Определяет имя модуля, версию, ключ конфигурации и совместимость.                      |
| `defaults`         | `T \| ((nuxt: Nuxt) => T)`{lang="ts"}                                | `false`  | Опции по умолчанию для модуля. Если предоставлена функция, она будет вызвана с экземпляром Nuxt в качестве первого аргумента. |
| `schema`           | `T`                                                                  | `false`  | Схема для опций модуля. Если предоставлена, опции будут применены к схеме.                              |
| `hooks`            | `Partial<NuxtHooks>`{lang="ts"}                                      | `false`  | Хуки для установки в модуле. Если предоставлены, модуль установит хуки.                           |
| `setup`            | `(this: void, resolvedOptions: T, nuxt: Nuxt) => Awaitable<void \| false \| ModuleSetupInstallResult>`{lang="ts"} | `false`  | Функция настройки для модуля. Если предоставлена, модуль вызовет функцию настройки.    |

### Примеры

#### Использование `configKey` для настройки вашего модуля

При определении Nuxt модуля вы можете установить `configKey`, чтобы указать, как пользователи должны настраивать модуль в своем `nuxt.config`.

```ts
import { defineNuxtModule } from '@nuxt/kit'

export default defineNuxtModule({
  meta: {
    name: 'my-module',
    configKey: 'myModule'
  },
  defaults: {
    // Опции модуля
    enabled: true
  },
  setup (options) {
    if (options.enabled) {
      console.log('Мой Nuxt модуль включен!')
    }
  }
})
```

Пользователи могут предоставить опции для этого модуля под соответствующим ключом в `nuxt.config`.

```ts
export default defineNuxtConfig({
  myModule: {
    enabled: false
  }
})
```

#### Определение требований совместимости модуля

Если вы разрабатываете Nuxt модуль и используете API, которые поддерживаются только в определенных версиях Nuxt, настоятельно рекомендуется включить `compatibility.nuxt`.

```ts
export default defineNuxtModule({
  meta: {
    name: '@nuxt/icon',
    configKey: 'icon',
    compatibility: {
      // Требуемая версия nuxt в формате semver.
      nuxt: '>=3.0.0', // или используйте '^3.0.0'
    },
  },
  async setup() {
    const resolver = createResolver(import.meta.url)
    // Реализация
  },
})
```

Если пользователь попытается использовать ваш модуль с несовместимой версией Nuxt, он получит предупреждение в консоли.

```terminal
 WARN  Модуль @nuxt/icon отключен из-за проблем совместимости:
 - [nuxt] Требуется версия Nuxt ^3.1.0, но в настоящее время используется 3.0.0
```

#### Типобезопасность для разрешенных опций с `.with()`

Когда вам нужна типобезопасность для ваших разрешенных/объединенных опций модуля, вы можете использовать метод `.with()`. Это позволяет TypeScript правильно выводить связь между значениями по умолчанию вашего модуля и окончательными разрешенными опциями, которые получает ваша функция настройки.

```ts
import { defineNuxtModule } from '@nuxt/kit'

// Определите интерфейс опций вашего модуля
interface ModuleOptions {
  apiKey: string
  baseURL: string
  timeout?: number
  retries?: number
}

export default defineNuxtModule<ModuleOptions>().with({
  meta: {
    name: '@nuxtjs/my-api',
    configKey: 'myApi'
  },
  defaults: {
    baseURL: 'https://api.example.com',
    timeout: 5000,
    retries: 3
  },
  setup(resolvedOptions, nuxt) {
    // resolvedOptions правильно типизирован как:
    // {
    //   apiKey: string          // Обязательно, значение по умолчанию не предоставлено
    //   baseURL: string         // Обязательно, имеет значение по умолчанию
    //   timeout: number         // Необязательно, имеет значение по умолчанию
    //   retries: number         // Необязательно, имеет значение по умолчанию  
    // }
    
    console.log(resolvedOptions.baseURL) // ✅ TypeScript знает, что это всегда определено
    console.log(resolvedOptions.timeout) // ✅ TypeScript знает, что это всегда определено
    console.log(resolvedOptions.retries) // ✅ TypeScript знает, что это всегда определено
  }
})
```

Без использования `.with()` параметр `resolvedOptions` был бы типизирован как исходный интерфейс `ModuleOptions`, где `timeout` и `retries` могли бы быть `undefined`, даже когда предоставлены значения по умолчанию. Метод `.with()` позволяет TypeScript понимать, что значения по умолчанию делают эти свойства необязательными в разрешенных опциях.

## `installModule`

Программная установка указанного модуля Nuxt. Это полезно, когда ваш модуль зависит от других модулей. Вы можете передать параметры модуля как объект в `inlineOptions`, и они будут переданы в функцию `setup` модуля.

### Использование

```ts twoslash
import { defineNuxtModule, installModule } from '@nuxt/kit'

export default defineNuxtModule({  
  async setup () {
    // установит @nuxtjs/fontaine со шрифтом Roboto и резервным шрифтом Impact
    await installModule('@nuxtjs/fontaine', {
      // конфигурация модуля
      fonts: [
        {
          family: 'Roboto',
          fallbacks: ['Impact'],
          fallbackName: 'fallback-a',
        }
      ]
    })
  }
})
```

### Тип

```ts
async function installModule (moduleToInstall: string | NuxtModule, inlineOptions?: any, nuxt?: Nuxt)
```

### Параметры

| Свойство           | Тип                                          | Обязательный | Описание                                                                                                        |
| ------------------ | -------------------------------------------- | ------------ | --------------------------------------------------------------------------------------------------------------- |
| `moduleToInstall`  | `string \| NuxtModule`{lang="ts"}            | `true`       | Модуль для установки. Может быть либо строкой с именем модуля, либо самим объектом модуля.                     |
| `inlineOptions`    | `any`                                        | `false`      | Объект с параметрами модуля, которые будут переданы в функцию `setup` модуля.                                  |
| `nuxt`             | `Nuxt`                                       | `false`      | Экземпляр Nuxt. Если не предоставлен, он будет получен из контекста через вызов `useNuxt()`.                  |

### Примеры

```ts
import { defineNuxtModule, installModule } from '@nuxt/kit'

export default defineNuxtModule({  
  async setup (options, nuxt) {
    // установит @nuxtjs/fontaine со шрифтом Roboto и резервным шрифтом Impact
    await installModule('@nuxtjs/fontaine', {
      // конфигурация модуля
      fonts: [
        {
          family: 'Roboto',
          fallbacks: ['Impact'],
          fallbackName: 'fallback-a',
        }
      ]
    })
  }
})
```