---
title: "Обработка ошибок"
description: "Узнайте, как перехватывать и обрабатывать ошибки в Nuxt."
navigation.icon: i-lucide-bug-off
---

Nuxt — это full-stack фреймворк, что означает наличие нескольких источников неизбежных пользовательских ошибок времени выполнения, которые могут происходить в различных контекстах:

- Ошибки во время жизненного цикла рендеринга Vue (SSR и CSR)
- Ошибки запуска сервера и клиента (SSR + CSR)
- Ошибки во время жизненного цикла сервера Nitro (директория [`server/`](/docs/guide/directory-structure/server))
- Ошибки загрузки JS-чанков

::tip
**SSR** означает **Server-Side Rendering** (рендеринг на стороне сервера), а **CSR** — **Client-Side Rendering** (рендеринг на стороне клиента).
::

## Ошибки Vue

Вы можете перехватывать ошибки Vue с помощью [`onErrorCaptured`](https://vuejs.org/api/composition-api-lifecycle.html#onerrorcaptured).

Кроме того, Nuxt предоставляет хук [`vue:error`](/docs/api/advanced/hooks#app-hooks-runtime), который будет вызван, если любые ошибки распространятся до верхнего уровня.

Если вы используете фреймворк для отчетности об ошибках, вы можете предоставить глобальный обработчик через [`vueApp.config.errorHandler`](https://vuejs.org/api/application.html#app-config-errorhandler). Он будет получать все ошибки Vue, даже если они обработаны.

```ts twoslash [plugins/error-handler.ts]
export default defineNuxtPlugin((nuxtApp) => {
  nuxtApp.vueApp.config.errorHandler = (error, instance, info) => {
    // обработка ошибки, например, отправка в сервис
  }

  // Также возможно
  nuxtApp.hook('vue:error', (error, instance, info) => {
    // обработка ошибки, например, отправка в сервис
  })
})
```

::note
Обратите внимание, что хук `vue:error` основан на хуке жизненного цикла [`onErrorCaptured`](https://vuejs.org/api/composition-api-lifecycle.html#onerrorcaptured).
::

## Ошибки запуска

Nuxt вызовет хук `app:error`, если возникнут какие-либо ошибки при запуске вашего Nuxt приложения.

Это включает:
- выполнение [плагинов Nuxt](/docs/guide/directory-structure/plugins)
- обработку хуков `app:created` и `app:beforeMount`
- рендеринг вашего Vue приложения в HTML (во время SSR)
- монтирование приложения (на клиентской стороне), хотя этот случай следует обрабатывать с помощью `onErrorCaptured` или `vue:error`
- обработку хука `app:mounted`

## Ошибки сервера Nitro

В настоящее время вы не можете определить серверный обработчик для этих ошибок, но можете отобразить страницу ошибки, см. раздел [Render an Error Page](#error-page).

## Ошибки с JS чанками

Вы можете столкнуться с ошибками загрузки чанков из-за сбоя сетевого подключения или нового развертывания (которое делает недействительными ваши старые хешированные URL JS чанков). Nuxt предоставляет встроенную поддержку для обработки ошибок загрузки чанков, выполняя жесткую перезагрузку, когда чанк не удается загрузить во время навигации по маршруту.

Вы можете изменить это поведение, установив `experimental.emitRouteChunkError` в `false` (чтобы полностью отключить перехват этих ошибок) или в `manual`, если вы хотите обрабатывать их самостоятельно. Если вы хотите обрабатывать ошибки загрузки чанков вручную, вы можете ознакомиться с [автоматической реализацией](https://github.com/nuxt/nuxt/blob/main/packages/nuxt/src/app/plugins/chunk-reload.client.ts) для получения идей.

## Страница ошибки

::note
Когда Nuxt сталкивается с критической ошибкой (любая необработанная ошибка на сервере или ошибка, созданная с `fatal: true` на клиенте), он либо отобразит JSON-ответ (если запрошено с заголовком `Accept: application/json`), либо запустит полноэкранную страницу ошибки.
::

Ошибка может возникнуть во время жизненного цикла сервера при:
- обработке ваших Nuxt плагинов
- рендеринге вашего Vue приложения в HTML
- возникновении ошибки в серверном API маршруте

Она также может возникнуть на стороне клиента при:
- обработке ваших Nuxt плагинов
- перед монтированием приложения (хук `app:beforeMount`)
- монтировании вашего приложения, если ошибка не была обработана с помощью `onErrorCaptured` или хука `vue:error`
- инициализации и монтировании Vue приложения в браузере (`app:mounted`).

::read-more{to="/docs/api/advanced/hooks"}
Изучите все хуки жизненного цикла Nuxt.
::

Настройте страницу ошибки по умолчанию, добавив `~/error.vue` в исходную директорию вашего приложения, рядом с `app.vue`.

<!-- TODO:twoslash: Twoslash does not support tsconfig paths yet -->

```vue [error.vue]
<script setup lang="ts">
import type { NuxtError } from '#app'

const props = defineProps({
  error: Object as () => NuxtError
})

const handleError = () => clearError({ redirect: '/' })
</script>

<template>
  <div>
    <h2>{{ error?.statusCode }}</h2>
    <button @click="handleError">Очистить ошибки</button>
  </div>
</template>
```

::read-more{to="/docs/guide/directory-structure/error"}
Узнайте больше о `error.vue` и его использовании.
::

Для пользовательских ошибок мы настоятельно рекомендуем использовать композабл `onErrorCaptured`, который можно вызвать в функции setup страницы/компонента, или runtime nuxt хук `vue:error`, который можно настроить в nuxt плагине.

```ts twoslash [plugins/error-handler.ts]
export default defineNuxtPlugin(nuxtApp => {
  nuxtApp.hook('vue:error', (err) => {
    //
  })
})
```

Когда вы готовы удалить страницу ошибки, вы можете вызвать вспомогательную функцию [`clearError`](/docs/api/utils/clear-error), которая принимает необязательный путь для перенаправления (например, если вы хотите перейти на 'безопасную' страницу).

::important
Убедитесь, что проверили перед использованием чего-либо, зависящего от Nuxt плагинов, такого как `$route` или `useRouter`, поскольку если плагин выбросил ошибку, то он не будет запущен повторно, пока вы не очистите ошибку.
::

::note
Рендеринг страницы ошибки - это полностью отдельная загрузка страницы, что означает, что любое зарегистрированное промежуточное ПО будет запущено снова. Вы можете использовать [`useError`](#useerror) в промежуточном ПО для проверки, обрабатывается ли ошибка.
::

::note
Если вы работаете на Node 16 и устанавливаете какие-либо cookies при рендеринге страницы ошибки, они [перезапишут ранее установленные cookies](https://github.com/nuxt/nuxt/pull/20585). Мы рекомендуем использовать более новую версию Node, поскольку Node 16 достиг конца жизни в сентябре 2023 года.
::

## Утилиты для ошибок

### `useError`

```ts [TS Signature]
function useError (): Ref<Error | { url, statusCode, statusMessage, message, description, data }>
```

Эта функция возвращает глобальную ошибку Nuxt, которая в данный момент обрабатывается.

::read-more{to="/docs/api/composables/use-error"}
Узнайте больше о композабле `useError`.
::

### `createError`

```ts [TS Signature]
function createError (err: string | { cause, data, message, name, stack, statusCode, statusMessage, fatal }): Error
```

Создает объект ошибки с дополнительными метаданными. Вы можете передать строку, которая будет установлена как `message` ошибки, или объект, содержащий свойства ошибки. Функция может использоваться как в Vue, так и в серверной части вашего приложения и предназначена для выброса исключений.

Если вы выбрасываете ошибку, созданную с помощью `createError`:
- на серверной стороне это вызовет полноэкранную страницу ошибки, которую можно очистить с помощью [`clearError`](#clearerror).
- на клиентской стороне это выбросит некритичную ошибку для вашей обработки. Если вам нужно вызвать полноэкранную страницу ошибки, то вы можете сделать это, установив `fatal: true`.

```vue twoslash [pages/movies/[slug\\].vue]
<script setup lang="ts">
const route = useRoute()
const { data } = await useFetch(`/api/movies/${route.params.slug}`)

if (!data.value) {
  throw createError({
    statusCode: 404,
    statusMessage: 'Page Not Found'
  })
}
</script>
```

::read-more{to="/docs/api/utils/create-error"}
Узнайте больше об утилите `createError`.
::

### `showError`

```ts [TS Signature]
function showError (err: string | Error | { statusCode, statusMessage }): Error
```

Вы можете вызвать эту функцию в любой момент на клиентской стороне или (на серверной стороне) непосредственно в middleware, плагинах или функциях `setup()`. Это вызовет полноэкранную страницу ошибки, которую можно очистить с помощью [`clearError`](#clearerror).

Рекомендуется вместо этого использовать `throw createError()`.

::read-more{to="/docs/api/utils/show-error"}
Узнайте больше об утилите `showError`.
::

### `clearError`

```ts [TS Signature]
function clearError (options?: { redirect?: string }): Promise<void>
```

Эта функция очистит текущую обрабатываемую ошибку Nuxt. Она также принимает необязательный путь для перенаправления (например, если вы хотите перейти на "безопасную" страницу).

::read-more{to="/docs/api/utils/clear-error"}
Узнайте больше об утилите `clearError`.
::

## Ошибка рендеринга в компоненте

Nuxt также предоставляет компонент [`<NuxtErrorBoundary>`](/docs/api/components/nuxt-error-boundary), который позволяет обрабатывать клиентские ошибки в вашем приложении, не заменяя весь сайт страницей ошибки.

Этот компонент отвечает за обработку ошибок, которые возникают в его слоте по умолчанию. На клиентской стороне он предотвращает всплытие ошибки на верхний уровень и вместо этого рендерит слот `#error`.

Слот `#error` получит `error` в качестве пропа. (Если вы установите `error = null`, это запустит повторный рендеринг слота по умолчанию; вам нужно убедиться, что ошибка полностью устранена, иначе слот ошибки будет просто отрендерен второй раз.)

::tip
Если вы перейдете на другой маршрут, ошибка будет автоматически очищена.
::

```vue [pages/index.vue]
<template>
  <!-- некоторый контент -->
  <NuxtErrorBoundary @error="someErrorLogger">
    <!-- Вы используете слот по умолчанию для рендеринга вашего контента -->
    <template #error="{ error, clearError }">
      Вы можете отобразить ошибку локально здесь: {{ error }}
      <button @click="clearError">
        Это очистит ошибку.
      </button>
    </template>
  </NuxtErrorBoundary>
</template>
```

:link-example{to="/docs/examples/advanced/error-handling"}